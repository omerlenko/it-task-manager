{% extends "base.html" %}

{% block content %}

  <div class="container mt-4">
    <div class="row g-4">
      <h1 class="text-center">Dashboard</h1>

      <div>
        <form method="get">
          <label for="user-select">Assignee:</label>
          <select name="user_id" id="user-select" class="form-select" onchange="this.form.submit()">
            {% for user in users %}
              <option value="{{ user.id }}" {% if user.id == selected_user.id %}selected{% endif %}>
                {{ user.first_name }} {{ user.last_name }}
              </option>
            {% endfor %}
          </select>
        </form>
      </div>

      <!-- Task Overview Card -->
      <div class="col-md-6">
        <div class="card shadow-sm h-100">
          <div class="card-header text-center fs-3">Task Overview</div>
          <div class="card-body d-flex flex-column justify-content-center p-4">
            <div class="d-flex align-items-center mb-2">
              <div class="circle clr-primary me-3"></div>
              <div class="fs-4 me-auto">Total Tasks</div>
              <div class="fs-2 fw-bold">
                <a href="{% url "task_manager:task-list" %}?assignees={{ selected_user }}" class="text-decoration-none text-dark">
                  {{ total_tasks }}
                </a>
              </div>
            </div>
            <div class="d-flex align-items-center mb-2">
              <div class="circle clr-warning me-3"></div>
              <div class="fs-4 me-auto">Pending</div>
              <div class="fs-2 fw-bold">
                <a href="{% url "task_manager:task-list" %}?assignees={{ selected_user }}&is_completed=False" class="text-decoration-none text-dark">
                  {{ pending_tasks }}
                </a>
              </div>
            </div>
            <div class="d-flex align-items-center">
              <div class="circle clr-success me-3"></div>
              <div class="fs-4 me-auto">Completed</div>
              <div class="fs-2 fw-bold">
                <a href="{% url "task_manager:task-list" %}?assignees={{ selected_user }}&is_completed=True" class="text-decoration-none text-dark">
                  {{ completed_tasks }}
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Upcoming Deadlines Card -->
      <div class="col-md-6">
        <div class="card shadow-sm h-100">
          <div class="card-header text-center fs-3">Upcoming Deadlines</div>
          <div class="card-body p-3">
            <ul class="list-group">
              {% for task in upcoming_deadlines %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  <a href="{% url 'task_manager:task-detail' pk=task.id %}" class="text-decoration-none text-dark fs-5">
                    {{ task.name }}
                  </a>
                  <span class="badge bg-danger">{{ task.deadline|date:"M d" }}</span>
                </li>
              {% empty %}
                <li class="list-group-item text-muted text-center">No upcoming tasks</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>

      <!-- Task Count by Priority -->
      <div class="col-md-6">
        <div class="card shadow-sm h-100">
          <div class="card-header text-center fs-3">Tasks by Priority</div>
          <div class="card-body d-flex flex-column justify-content-center p-4">
            {% for priority, count in task_priority_counts.items %}
              <div class="d-flex  align-items-center mb-2">

                <div class="circle me-3
                 {% if priority == "1" %} clr-danger
                 {% elif priority == "2" %} clr-warning
                 {% elif priority == "3" %} clr-primary
                 {% else %} clr-default
                 {% endif %}"></div>

                <span class="fs-4 me-auto">
                  {% if priority  == "1" %}Urgent
                  {% elif priority == "2" %}High
                  {% elif priority == "3" %} Medium
                  {% else %} Low
                  {% endif %}
                </span>

                <span class="fs-2 fw-bold">
                  <a href="{% url "task_manager:task-list" %}?priority={{ priority }}&assignees={{ request.user.id }}" class="text-decoration-none text-dark">
                    {{ count }}
                  </a>
                </span>

              </div>
            {% empty %}
              <p class="fs-5 text-muted text-center">No priority tasks</p>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- Weekly Progress -->
      <div class="col-md-6">
        <div class="card shadow-sm h-100">
          <div class="card-header text-center fs-3">This Week's Progress</div>
          <div class="card-body d-flex flex-column justify-content-center text-center p-4">
            <div class="fs-4 mb-3"><strong>{{ weekly_completed_tasks }} / {{ weekly_total_tasks }}</strong> completed</div>
            <div class="progress mx-auto mb-3" style="height: 16px; width: 80%;">
              <div class="progress-bar progress-bar-striped progress-bar-animated bg-success"
                   role="progressbar"
                   style="width: {{ weekly_completion_percentage }}%;"
                   aria-valuenow="{{ weekly_completion_percentage }}"
                   aria-valuemin="0" aria-valuemax="100">
              </div>
            </div>
            <small class="text-muted fs-5">{{ weekly_completion_percentage }}% of this week's tasks done</small>
          </div>
        </div>
      </div>
      <div class="mt-4">
        <a href="{% url "task_manager:task-create" %}" class="btn btn-primary">Add New Task</a>
      </div>
    </div>
  </div>

{% endblock %}
